<!DOCTYPE HTML>
<html>
    <head>
	    <meta charset="utf-8">
		<title>Steam games, convert names to steam links</title>
	</head>
	<body>
	  <h1> TEST </h1>
	      <p><input type="text" id="raw" value="paste games here" /> <button onclick="saveList();">Submit</button> </p>
	  

      <h2>The List!</h2>	  
	      <p>placeholder for where the list will go!</p>
		  <ul id="displayedList">
		      <li>placeholder list item</li>
		  </ul>
	</body>
	
	
	
	<script>
	    let steam; // where the parsed steam json is stored
		let singleId = []; // used in the findGame function to save reddit markdown ready links
		let multipleId = [];
		let notFound = [];
		let userList; // users input saved in the saveList function
		
	    var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
            // Typical action to be performed when the document is ready:
                steam = JSON.parse(xhttp.responseText);
				console.log(steam.applist.apps);
            }
        };
        xhttp.open("GET", "steamGames.json", true);  // need to run node live server to get data from json file https://youtu.be/wI1CWzNtE-M?t=1300
        xhttp.send();
	
	    function saveList(){ // triggered upon button press, saves the user's list than calls findGame() function
		    userList = document.getElementById('raw').value; 
			console.log("userList saved during saveList function");
			findGame();
		}
	    function findGame(){
		console.log("findGame function triggered"); console.log(userList);
		    let foundId = [];
		    for (let i=0; i<steam.applist.apps.length;i++){
			console.log("for loop triggered!");
			    if (userList === steam.applist.apps[i].name) {
				console.log("found a match!!! hoo fucking rah!!");
			        foundId.push("[" + userList + "]" + "(" + "https://store.steampowered.com/app/" + steam.applist.apps[i].appid + ")"); // pushes reddit markdown ready links to the array
					console.log(foundId);
				}
			} console.log("for loop finished!");
       		function checkFound(){	
				if (foundId.length > 1){
				    multipleId.push(foundId); console.log("it found more than 2 matches for 1 game!");
				}  else if (foundId.length === 1) {
				    singleId.push(foundId); console.log("1 match, nice");
				}  else {
				    notFound.push(userList); console.log("it didn't find a match");  
				}
			}
			
			for (let i=0; i<singleId.length; i++){
			   	let listedLink = document.createElement("li"); // makes a <li></li> element learned from https://youtu.be/K3jb8_pPlRQ?t=2389
				    console.log(listedLink);
				let test = document.createTextNode(singleId[i]); // creates a text node?? idk have to look into it more
				    console.log(test);
				listedLink.appendChild(test); // adds the test variable to the <li> created above
				    console.log(listedLink); console.log("li should have been logged twice now!");
				document.getElementById("displayedList").appendChild(listedLink); // adds the newly created <li> to the html's ul
			        console.log("list item should be made!");
				}	
		}
	
	
	
	
	/*
	  TO DO,
	    X need to find how to access json, 
		 X search json by game name,
		   the games can currently be found but only with the same name and punctuation as listed in the JSON, for useability I should convert all letters to same case? 
		   need to remove Â® (copyright symbol)from the search & and possibly end the game name at : ? a few games seem to only match when the name before ":" is used example - Override: Mech City Brawl is only found with Override
		X once appID is returned I can add it to https://store.steampowered.com/app/
		  X find reddits way of formatting links, [test link](https://www.google.com) must be inputted from markdown mode
		
        need to seperate into 3 lists,  1. games found with a single match  2. games found with multiple matches   3. games with no matches found 
		
		get it working for multiple names at a time

        set it up to run locally i.e if hosted on a site, frontend javascript will call 	https://api.steampowered.com/ISteamApps/GetAppList/v2/	or site updates list every so often? 
		
	*/
	
	</script>
	
	
</html>
